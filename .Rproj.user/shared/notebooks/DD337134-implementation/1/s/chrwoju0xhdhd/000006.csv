"0","library(sl3)"
"0","library(simcausal)"
"0","library(hal9001)"
"0","#passes <- c()"
"0","for(i in 1:200){"
"0","  n <- 1500"
"0","  D <- DAG.empty()"
"0","  D <- D +"
"0","    node(""W1"", distr = ""runif"", min = -1, max = 1) +"
"0","    node(""W2"", distr = ""runif"", min = -1, max = 1) +"
"0","    node(""A"", distr = ""rbinom"", size = 1, prob = plogis(W1 + W2) )+"
"0","    node(""Z"", distr = ""rnorm"", mean = W1 + 0.5*A, sd = 2.5) +"
"0","    node(""Q"", distr = ""rconst"", const = plogis(A + A*(0.5*W1 + W1^2) + sin(5*W1) + cos(4*W2)))+"
"0","    node(""Q1"", distr = ""rconst"", const = plogis(1 + (0.5*W1 + W1^2) + sin(5*W1) + cos(4*W2)))+"
"0","    node(""Q0"", distr = ""rconst"", const = plogis(0 + sin(5*W1) + cos(4*W2)))+"
"0","    node(""OR"", distr = ""rconst"", const = Q1*(1-Q0)/(Q0*(1-Q1)))+"
"0","    node(""Y"", distr = ""rbinom"", size = 1, prob = Q) + "
"0","    node(""Delta"", distr = ""rbinom"", size = 1, prob = 1- 0.3*plogis(W1 + Z + W2 + A))"
"0","  true <- c(1,1)"
"0","  setD <- set.DAG(D )"
"0","  data <- sim(setD, n = n)"
"0","  data$Y <- data$Y * data$Delta"
"0","  true <- c(1, 0.5, 1)"
"0","  #fit <- npOR(~1 + W1^2 + W2^2, W = data[,c(""W1"", ""W2"")], A = data$A, Y = data$Y, glm_formula_A = ~ .^2, glm_formula_Y = ~ .^2  )"
"0","  fit <- npORmissing(~ poly(W1,degree=2, raw = T)   , W = data[,c(""W1"", ""W2"")], A = data$A, Y = data$Y , Z = data$Z, Delta = data$Delta, num_knots_Y = c(20,1), max_degree_Y = 2, sl3_learner_Delta = Lrnr_gam$new() , sl3_learner_A = Lrnr_gam$new()  )"
"0","  ci <- fit$coefs"
"0","  "
"0","  passes <- cbind(passes, ci[,3] <= true & ci[,4] >= true)"
"0","  print(rowMeans(passes))"
"0","  print(apply(passes,1,table))"
"0","}"
"2","...automatically assigning order attribute to some nodes...
"
"2","node W1, order:1
"
"2","node W2, order:2
"
"2","node A, order:3
"
"2","node Z, order:4
"
"2","node Q, order:5
"
"2","node Q1, order:6
"
"2","node Q0, order:7
"
"2","node OR, order:8
"
"2","node Y, order:9
"
"2","node Delta, order:10
"
"2","simulating observed dataset from the DAG object
"
"1","[1]"
"1"," ""Learning barQ"""
"1","
"
"1",""
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","0.07897062 "
"1","0.43703406 "
"1","0.65599609 "
"1","0.80349530 "
"1","0.97667091 "
"1","
"
"1","[1]"
"1"," ""Learning Q"""
"1","
"
"1","       0% "
"1","      25% "
"1","      50% "
"1","      75% "
"1","     100% "
"1","
"
"1","0.1352767 "
"1","0.4421671 "
"1","0.6474465 "
"1","0.7951586 "
"1","0.9648723 "
"1","
"
"1",""
"1","[1]"
"1"," 0.6643135"
"1"," 0.9994678"
"1","
"
"1",""
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.006035361"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 1.114264e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-102.936949 "
"1","   2.049804 "
"1","   8.683661 "
"1","  63.291379 "
"1"," 307.625338 "
"1","
"
"1","[1]"
"1"," 1.438887e-11"
"1","
"
"1","[1]"
"1"," 2.277026"
"1","
"
"1","[1]"
"1"," 2.277026"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 2.277026"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.004018655"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 2.924798e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-107.947152 "
"1","   1.131457 "
"1","  20.037147 "
"1","  58.699591 "
"1"," 412.766602 "
"1","
"
"1","[1]"
"1"," 1.241441e-10"
"1","
"
"1","[1]"
"1"," 0.08317483"
"1","
"
"1","[1]"
"1"," 0.08317483"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.08317483"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.0001438625"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-108.314272 "
"1","   1.164828 "
"1","  19.313297 "
"1","  58.591033 "
"1"," 417.049822 "
"1","
"
"1","[1]"
"1"," 1.274314e-10"
"1","
"
"1","[1]"
"1"," 0.002725316"
"1","
"
"1","[1]"
"1"," 0.002725316"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.002725316"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 6.098819e-06"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-108.322478 "
"1","   1.165306 "
"1","  19.293360 "
"1","  58.586198 "
"1"," 417.166601 "
"1","
"
"1","[1]"
"1"," 1.275196e-10"
"1","
"
"1","[1]"
"1"," 9.07936e-05"
"1","
"
"1","[1]"
"1"," 9.079366e-05"
"1","
"
"1","[1]"
"1"," ""converged"""
"1","
"
"1","                              "
"1"," (Intercept)"
"1"," poly(W1, degree = 2, raw = T)1"
"1","
(Intercept)                   "
"1","   58.586198"
"1","                       1.165306"
"1","
poly(W1, degree = 2, raw = T)1"
"1","    1.165306"
"1","                     117.092681"
"1","
poly(W1, degree = 2, raw = T)2"
"1"," -108.322478"
"1","                      19.293360"
"1","
"
"1","                              "
"1"," poly(W1, degree = 2, raw = T)2"
"1","
(Intercept)                   "
"1","                     -108.32248"
"1","
poly(W1, degree = 2, raw = T)1"
"1","                       19.29336"
"1","
poly(W1, degree = 2, raw = T)2"
"1","                      417.16660"
"1","
"
"1","                   (Intercept) "
"1","poly(W1, degree = 2, raw = T)1 "
"1","poly(W1, degree = 2, raw = T)2 "
"1","
"
"1","                     0.9583333 "
"1","                     0.9166667 "
"1","                     0.8750000 "
"1","
"
"1","     "
"1"," (Intercept)"
"1"," poly(W1, degree = 2, raw = T)1"
"1"," poly(W1, degree = 2, raw = T)2"
"1","
FALSE"
"1","           1"
"1","                              2"
"1","                              3"
"1","
TRUE "
"1","          23"
"1","                             22"
"1","                             21"
"1","
"
"2","...automatically assigning order attribute to some nodes...
"
"2","node W1, order:1
"
"2","node W2, order:2
"
"2","node A, order:3
"
"2","node Z, order:4
"
"2","node Q, order:5
"
"2","node Q1, order:6
"
"2","node Q0, order:7
"
"2","node OR, order:8
"
"2","node Y, order:9
"
"2","node Delta, order:10
"
"2","simulating observed dataset from the DAG object
"
"1","[1]"
"1"," ""Learning barQ"""
"1","
"
"1",""
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","0.07223241 "
"1","0.42649439 "
"1","0.66062216 "
"1","0.81998945 "
"1","0.99719063 "
"1","
"
"1","[1]"
"1"," ""Learning Q"""
"1","
"
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","0.09356313 "
"1","0.42804077 "
"1","0.65931680 "
"1","0.81564267 "
"1","0.96301596 "
"1","
"
"1",""
"1","[1]"
"1"," 0.3456714"
"1"," 1.0000000"
"1","
"
"1",""
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.0240715"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 6.454174e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-134.803255 "
"1"," -25.308177 "
"1","   9.489975 "
"1","  74.548662 "
"1"," 421.207804 "
"1","
"
"1","[1]"
"1"," 1.277034e-15"
"1","
"
"1","[1]"
"1"," 0.3987182"
"1","
"
"1","[1]"
"1"," 0.3987182"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.3987182"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.002429006"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 1.03089e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","-141.57487 "
"1"," -32.27523 "
"1","  10.90319 "
"1","  75.45747 "
"1"," 467.50227 "
"1","
"
"1","[1]"
"1"," 7.261895e-15"
"1","
"
"1","[1]"
"1"," 0.01054874"
"1","
"
"1","[1]"
"1"," 0.01054874"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.01054874"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 6.650122e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","-141.83841 "
"1"," -32.82807 "
"1","  10.97571 "
"1","  75.52034 "
"1"," 468.97615 "
"1","
"
"1","[1]"
"1"," 5.452157e-15"
"1","
"
"1","[1]"
"1"," 0.0005026618"
"1","
"
"1","[1]"
"1"," 0.0005026618"
"1","
"
"1","[1]"
"1"," ""converged"""
"1","
"
"1","                              "
"1"," (Intercept)"
"1"," poly(W1, degree = 2, raw = T)1"
"1","
(Intercept)                   "
"1","    75.52034"
"1","                       10.97571"
"1","
poly(W1, degree = 2, raw = T)1"
"1","    10.97571"
"1","                      109.99690"
"1","
poly(W1, degree = 2, raw = T)2"
"1","  -141.83841"
"1","                      -32.82807"
"1","
"
"1","                              "
"1"," poly(W1, degree = 2, raw = T)2"
"1","
(Intercept)                   "
"1","                     -141.83841"
"1","
poly(W1, degree = 2, raw = T)1"
"1","                      -32.82807"
"1","
poly(W1, degree = 2, raw = T)2"
"1","                      468.97615"
"1","
"
"1","                   (Intercept) "
"1","poly(W1, degree = 2, raw = T)1 "
"1","poly(W1, degree = 2, raw = T)2 "
"1","
"
"1","                          0.96 "
"1","                          0.92 "
"1","                          0.88 "
"1","
"
"1","     "
"1"," (Intercept)"
"1"," poly(W1, degree = 2, raw = T)1"
"1"," poly(W1, degree = 2, raw = T)2"
"1","
FALSE"
"1","           1"
"1","                              2"
"1","                              3"
"1","
TRUE "
"1","          24"
"1","                             23"
"1","                             22"
"1","
"
"2","...automatically assigning order attribute to some nodes...
"
"2","node W1, order:1
"
"2","node W2, order:2
"
"2","node A, order:3
"
"2","node Z, order:4
"
"2","node Q, order:5
"
"2","node Q1, order:6
"
"2","node Q0, order:7
"
"2","node OR, order:8
"
"2","node Y, order:9
"
"2","node Delta, order:10
"
"2","simulating observed dataset from the DAG object
"
"1","[1]"
"1"," ""Learning barQ"""
"1","
"
"1",""
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","0.08551609 "
"1","0.40906611 "
"1","0.62429464 "
"1","0.79374188 "
"1","0.96372049 "
"1","
"
"1","[1]"
"1"," ""Learning Q"""
"1","
"
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","0.09557671 "
"1","0.41198215 "
"1","0.62220320 "
"1","0.78977649 "
"1","0.96056617 "
"1","
"
"1",""
"1","[1]"
"1"," 0.5480706"
"1"," 0.9996742"
"1","
"
"1",""
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.008048173"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 1.453347e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-105.499857 "
"1","   1.251132 "
"1","   2.643018 "
"1","  63.335164 "
"1"," 314.553527 "
"1","
"
"1","[1]"
"1"," 6.91177e-12"
"1","
"
"1","[1]"
"1"," 2.02186"
"1","
"
"1","[1]"
"1"," 2.02186"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 2.02186"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.005127938"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 2.126157e-05"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-110.915349 "
"1","   3.485997 "
"1","   4.558583 "
"1","  60.638566 "
"1"," 398.210770 "
"1","
"
"1","[1]"
"1"," 2.487388e-10"
"1","
"
"1","[1]"
"1"," 0.07708652"
"1","
"
"1","[1]"
"1"," 0.07708652"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.07708652"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.0001258939"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-111.188916 "
"1","   2.988582 "
"1","   3.594144 "
"1","  60.540887 "
"1"," 401.057517 "
"1","
"
"1","[1]"
"1"," 2.707247e-10"
"1","
"
"1","[1]"
"1"," 0.004027467"
"1","
"
"1","[1]"
"1"," 0.004027468"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 0.004027467"
"1","
"
"1","[1]"
"1"," ""Inner"""
"1","
"
"1","[1]"
"1"," 4.958499e-06"
"1","
"
"1","[1]"
"1"," ""checkConverged"""
"1","
"
"1","         0% "
"1","        25% "
"1","        50% "
"1","        75% "
"1","       100% "
"1","
"
"1","-111.192036 "
"1","   2.901479 "
"1","   3.599126 "
"1","  60.532166 "
"1"," 401.134795 "
"1","
"
"1","[1]"
"1"," 2.716212e-10"
"1","
"
"1","[1]"
"1"," 0.0002392798"
"1","
"
"1","[1]"
"1"," 0.0002392801"
"1","
"
"1","[1]"
"1"," ""converged"""
"1","
"
"1","                              "
"1"," (Intercept)"
"1"," poly(W1, degree = 2, raw = T)1"
"1","
(Intercept)                   "
"1","   60.532166"
"1","                       3.599126"
"1","
poly(W1, degree = 2, raw = T)1"
"1","    3.599126"
"1","                     107.396298"
"1","
poly(W1, degree = 2, raw = T)2"
"1"," -111.192036"
"1","                       2.901479"
"1","
"
"1","                              "
"1"," poly(W1, degree = 2, raw = T)2"
"1","
(Intercept)                   "
"1","                    -111.192036"
"1","
poly(W1, degree = 2, raw = T)1"
"1","                       2.901479"
"1","
poly(W1, degree = 2, raw = T)2"
"1","                     401.134795"
"1","
"
"1","                   (Intercept) "
"1","poly(W1, degree = 2, raw = T)1 "
"1","poly(W1, degree = 2, raw = T)2 "
"1","
"
"1","                     0.9615385 "
"1","                     0.9230769 "
"1","                     0.8846154 "
"1","
"
"1","     "
"1"," (Intercept)"
"1"," poly(W1, degree = 2, raw = T)1"
"1"," poly(W1, degree = 2, raw = T)2"
"1","
FALSE"
"1","           1"
"1","                              2"
"1","                              3"
"1","
TRUE "
"1","          25"
"1","                             24"
"1","                             23"
"1","
"
"2","...automatically assigning order attribute to some nodes...
"
"2","node W1, order:1
"
"2","node W2, order:2
"
"2","node A, order:3
"
"2","node Z, order:4
"
"2","node Q, order:5
"
"2","node Q1, order:6
"
"2","node Q0, order:7
"
"2","node OR, order:8
"
"2","node Y, order:9
"
"2","node Delta, order:10
"
"2","simulating observed dataset from the DAG object
"
"1","[1]"
"1"," ""Learning barQ"""
"1","
"
"1",""
"1","        0% "
"1","       25% "
"1","       50% "
"1","       75% "
"1","      100% "
"1","
"
"1","0.08844945 "
"1","0.41809573 "
"1","0.63071786 "
"1","0.80995789 "
"1","0.97924135 "
"1","
"
"1","[1]"
"1"," ""Learning Q"""
"1","
"
