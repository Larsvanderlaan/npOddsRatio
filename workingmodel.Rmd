---
title: "workingmodel"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
passes <- c()
for(i in 1:500){
  n <- 2500
  D <- DAG.empty()
 
  D <- D +
    node("W1", distr = "runif", min = -1, max = 1) +
    node("W2", distr = "runif", min = -1, max = 1) +
    node("A", distr = "rbinom", size = 1, prob = plogis(W1 + W2) )+
    node("Q", distr = "rconst", const = plogis(-1+A + A*(W1  ) + W1 + W2))+
    node("Y", distr = "rbinom", size = 1, prob = Q) + 
     node("G", distr = "rconst",const = 1- 0.7*plogis(W1 + W2  +A-0.5 ))+
    node("Delta", distr = "rbinom", size = 1, prob = G)
 
  setD <- set.DAG(D )
  data <- sim(setD, n = n)
  true <- c(1,1)
  lrnr <- Lrnr_hal9001_custom$new(max_degree = 2, num_knots = c(10,1))
  
  
  fit <- npORMissing(~ poly(W1,degree=1, raw = T)   , W = data[,c("W1", "W2")], A = data$A, Y = data$Y , Z = rbinom(n, 1,0.5),
                     Delta = data$Delta, sl3_learner_default = lrnr )
  ci <- fit$coefs
  
  passes <- cbind(passes, ci[,3] <= true & ci[,4] >= true)
 print(rowMeans(passes))
 
  print(apply(passes,1,table))
}

```
